<!DOCTYPE html>
<html>
<head>
    <title>Search Page Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        code { background: #f5f5f5; padding: 2px 5px; }
    </style>
</head>
<body>
    <h1>üß¨ OmicsOracle Search Page Diagnostic</h1>

    <div id="tests"></div>

    <script>
        const tests = [];

        async function runTests() {
            const container = document.getElementById('tests');

            // Test 1: Can reach server
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                addTest('Server Health', response.ok, `Status: ${data.status}`);
            } catch (e) {
                addTest('Server Health', false, e.message);
            }

            // Test 2: Can auto-register
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'test@omicsoracle.com',
                        password: 'TestPassword123!',
                        full_name: 'Test User'
                    })
                });
                addTest('Auto-Register', response.ok || response.status === 400,
                    response.ok ? 'User created' : 'User already exists (OK)');
            } catch (e) {
                addTest('Auto-Register', false, e.message);
            }

            // Test 3: Can login
            let token = null;
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'test@omicsoracle.com',
                        password: 'TestPassword123!'
                    })
                });
                const data = await response.json();
                token = data.access_token;
                addTest('Login', response.ok, token ? 'Token received' : 'No token');
            } catch (e) {
                addTest('Login', false, e.message);
            }

            // Test 4: Can search with token
            if (token) {
                try {
                    const response = await fetch('http://localhost:8000/api/v1/agents/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            query: 'breast cancer',
                            enable_semantic: false,
                            filters: {},
                            max_results: 5
                        })
                    });
                    const data = await response.json();
                    addTest('Search API', response.ok,
                        `Found ${data.total_found || 0} results`);
                } catch (e) {
                    addTest('Search API', false, e.message);
                }
            } else {
                addTest('Search API', false, 'No auth token');
            }

            // Test 5: Check search page loads
            try {
                const response = await fetch('http://localhost:8000/search');
                addTest('Search Page', response.ok, `Status: ${response.status}`);
            } catch (e) {
                addTest('Search Page', false, e.message);
            }
        }

        function addTest(name, passed, details) {
            const container = document.getElementById('tests');
            const div = document.createElement('div');
            div.className = `test ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${passed ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
                <code>${details}</code>
            `;
            container.appendChild(div);
        }

        runTests();
    </script>
</body>
</html>
