# OmicsOracle - Visual Data Flow & Integration Map
**Version:** 2.0 (Phase 4 Complete)
**Date:** October 8, 2025
**Purpose:** Visual reference for understanding complete system architecture with Phase 4 multi-agent system

---

## ğŸ“Š Complete System Architecture (Phase 4)

### High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE LAYER                             â”‚
â”‚              (Dual Interface: Streamlit Dashboard + Web UI)             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Search     â”‚  â”‚   Results    â”‚  â”‚  AI Analysis â”‚  â”‚   Auth    â”‚ â”‚
â”‚  â”‚  Component   â”‚  â”‚   Display    â”‚  â”‚   Panels     â”‚  â”‚  (Login)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                 â”‚                 â”‚                â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                â”‚
          â”‚ HTTP REST + JWT Auth             â”‚                â”‚
          â”‚ JSON Responses                   â”‚                â”‚
          â–¼                 â–¼                 â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION & AUTHORIZATION                        â”‚
â”‚                     JWT Middleware (Port 8000)                          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Verify JWT tokens (access: 60min, refresh: 7 days)            â”‚  â”‚
â”‚  â”‚ â€¢ Rate limiting (100-1000 req/hour by user tier)                â”‚  â”‚
â”‚  â”‚ â€¢ RBAC (free, premium, admin)                                   â”‚  â”‚
â”‚  â”‚ â€¢ Audit logging                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY LAYER                                â”‚
â”‚                         FastAPI (Port 8000)                              â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/auth/*             /api/agents/*         /api/search/*     â”‚  â”‚
â”‚  â”‚  â”œâ”€ /register            â”œâ”€ /search            â”œâ”€ /datasets     â”‚  â”‚
â”‚  â”‚  â”œâ”€ /login               â”œâ”€ /analyze           â”œâ”€ /advanced     â”‚  â”‚
â”‚  â”‚  â”œâ”€ /refresh             â”œâ”€ /qa                â””â”€ /datasets/{id}â”‚  â”‚
â”‚  â”‚  â”œâ”€ /me                  â”œâ”€ /quality                            â”‚  â”‚
â”‚  â”‚  â””â”€ /logout              â””â”€ /recommend                          â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  /api/analysis/*         /api/analytics/*      /api/export/*    â”‚  â”‚
â”‚  â”‚  â”œâ”€ /citations           â”œâ”€ /user              â”œâ”€ [POST]        â”‚  â”‚
â”‚  â”‚  â”œâ”€ /biomarkers          â””â”€ /system            â”œâ”€ /{id}/status  â”‚  â”‚
â”‚  â”‚  â””â”€ /trends                                    â””â”€ /{id}/downloadâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚                       â”‚
          â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5-Agent System  â”‚  â”‚  LLM Integration â”‚  â”‚  Caching Layer   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ Query Agent   â”‚  â”‚  â€¢ GPT-4 Client   â”‚  â”‚  â€¢ Redis (60min) â”‚
â”‚  â€¢ Search Agent  â”‚  â”‚  â€¢ Token Mgmt     â”‚  â”‚  â€¢ SQLite (24h)  â”‚
â”‚  â€¢ Analysis Agentâ”‚  â”‚  â€¢ Cost Tracking  â”‚  â”‚  â€¢ File (30d)    â”‚
â”‚  â€¢ Quality Agent â”‚  â”‚  â€¢ Retry Logic    â”‚  â”‚  â€¢ 60%+ hit rate â”‚
â”‚  â€¢ Rec. Agent    â”‚  â”‚  â€¢ ~$0.04/analyze â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA SOURCE LAYER                                â”‚
â”‚                      (External APIs & Databases)                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NCBI    â”‚  â”‚  Google   â”‚  â”‚ Semantic â”‚  â”‚ OpenAI â”‚  â”‚ Internal â”‚  â”‚
â”‚  â”‚ GEO API â”‚  â”‚ Scholar   â”‚  â”‚ Scholar  â”‚  â”‚ GPT-4  â”‚  â”‚ Database â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Workflow Diagrams (Phase 4)

### Workflow 1: Authenticated Search & Multi-Agent Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AUTHENTICATED SEARCH WORKFLOW (Phase 4)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Optional] User Login (First Time)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: Login Component            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Capture email + password          â”‚
â”‚ 2. Validate inputs                   â”‚
â”‚ 3. Show loading state                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ POST /api/auth/login
              â”‚ {
              â”‚   "email": "user@example.com",
              â”‚   "password": "********"
              â”‚ }
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Auth Service                                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Verify credentials (bcrypt)                                   â”‚
â”‚ 2. Generate JWT tokens                                           â”‚
â”‚    â€¢ Access token (60 min)                                       â”‚
â”‚    â€¢ Refresh token (7 days)                                      â”‚
â”‚ 3. Return tokens + user info                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Response (<500ms):
              â”‚ {
              â”‚   "access_token": "eyJhbGc...",
              â”‚   "refresh_token": "eyJhbGc...",
              â”‚   "user": {
              â”‚     "id": "123",
              â”‚     "email": "user@example.com",
              â”‚     "tier": "premium",
              â”‚     "rate_limit": 1000
              â”‚   }
              â”‚ }
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: Store Tokens               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ localStorage.setItem('access_token') â”‚
â”‚ localStorage.setItem('refresh_token')â”‚
â”‚ Redirect to dashboard                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

User Types Query "breast cancer RNA-seq"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: SearchComponent            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Capture input                     â”‚
â”‚ 2. Validate query (min 3 chars)      â”‚
â”‚ 3. Get access token from storage     â”‚
â”‚ 4. Show loading skeleton             â”‚
â”‚ 5. Prepare request                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ POST /api/agents/search
              â”‚ Headers: {
              â”‚   "Authorization": "Bearer eyJhbGc...",
              â”‚   "Content-Type": "application/json"
              â”‚ }
              â”‚ Body: {
              â”‚   "search_terms": ["breast cancer", "RNA-seq"],
              â”‚   "enable_semantic": true,
              â”‚   "filters": {
              â”‚     "organism": "Homo sapiens",
              â”‚     "min_samples": 20,
              â”‚     "quality_threshold": 0.7
              â”‚   },
              â”‚   "max_results": 20
              â”‚ }
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIDDLEWARE: JWT Verification                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Extract & verify JWT token                      (<50ms)      â”‚
â”‚ 2. Check expiration                                              â”‚
â”‚ 3. Get user_id, role, tier                                       â”‚
â”‚ 4. Check rate limit (Redis)                                      â”‚
â”‚    â€¢ Premium: 945/1000 remaining                                 â”‚
â”‚ 5. If valid: Continue to agent                                   â”‚
â”‚ 6. If expired: Return 401 (frontend refreshes)                   â”‚
â”‚ 7. If rate exceeded: Return 429                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Multi-Agent Search Pipeline                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 1. Query    â”‚ Entity extraction & intent                     â”‚
â”‚  â”‚    Agent    â”‚ â€¢ disease="breast cancer"                      â”‚
â”‚  â”‚   (<1s)     â”‚ â€¢ study_type="RNA-seq"                         â”‚
â”‚  â”‚             â”‚ â€¢ organism="Homo sapiens"                      â”‚
â”‚  â”‚             â”‚ â€¢ intent="discovery"                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 2. Search   â”‚ Check Redis cache first                        â”‚
â”‚  â”‚    Agent    â”‚ Cache key: hash(terms + filters)               â”‚
â”‚  â”‚  (20-30s)   â”‚                                                â”‚
â”‚  â”‚             â”‚ IF CACHE MISS:                                 â”‚
â”‚  â”‚             â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚             â”‚â”€â”¤ NCBI GEO â”‚  â”‚  FAISS   â”‚                    â”‚
â”‚  â”‚             â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â”‚             â”‚      â”‚             â”‚                           â”‚
â”‚  â”‚             â”‚  Keyword      Semantic                         â”‚
â”‚  â”‚             â”‚  (BM25)       (Vectors)                        â”‚
â”‚  â”‚             â”‚      â”‚             â”‚                           â”‚
â”‚  â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚             â”‚ Merge & deduplicate                            â”‚
â”‚  â”‚             â”‚ 156 results â†’ 147 unique                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 3. Quality  â”‚ Score each dataset (parallel)                  â”‚
â”‚  â”‚    Agent    â”‚ â€¢ Metadata completeness                        â”‚
â”‚  â”‚    (<1s)    â”‚ â€¢ Sample size                                  â”‚
â”‚  â”‚             â”‚ â€¢ Publication status                           â”‚
â”‚  â”‚             â”‚ â€¢ Quality: 0.0-1.0 scale                       â”‚
â”‚  â”‚             â”‚ Filter: quality >= 0.7                         â”‚
â”‚  â”‚             â”‚ 147 â†’ 89 datasets (high quality)               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 4. Rank &   â”‚ Sort by:                                      â”‚
â”‚  â”‚    Sort     â”‚ â€¢ Relevance Ã— Quality                          â”‚
â”‚  â”‚             â”‚ â€¢ Recent first (if tied)                       â”‚
â”‚  â”‚             â”‚ Return top 20                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. Cache &  â”‚ Store in Redis (60 min TTL)                   â”‚
â”‚  â”‚   Return    â”‚ Track usage for analytics                      â”‚
â”‚  â”‚             â”‚ Increment user request count                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Response (22.3s uncached, <1s cached):
          â”‚ {
          â”‚   "status": "success",
          â”‚   "metadata": {
          â”‚     "total_results": 89,
          â”‚     "search_time": 22.3,
          â”‚     "cached": false,
          â”‚     "quality_stats": {
          â”‚       "avg_quality": 0.82,
          â”‚       "high_count": 67
          â”‚     }
          â”‚   },
          â”‚   "datasets": [
          â”‚     {
          â”‚       "geo_id": "GSE123456",
          â”‚       "title": "RNA-seq of breast cancer...",
          â”‚       "quality_score": 0.89,
          â”‚       "relevance_score": 0.94,
          â”‚       "sample_count": 45,
          â”‚       "organism": "Homo sapiens"
          â”‚     },
          â”‚     ... 19 more
          â”‚   ]
          â”‚ }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: ResultsComponent           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Hide loading skeleton             â”‚
â”‚ 2. Parse response                    â”‚
â”‚ 3. Render summary stats              â”‚
â”‚    â€¢ "Found 89 datasets"             â”‚
â”‚    â€¢ "Search time: 22.3s"            â”‚
â”‚    â€¢ "Avg quality: 0.82 â­â­â­â­"    â”‚
â”‚ 4. Render dataset cards              â”‚
â”‚    For each dataset:                 â”‚
â”‚    â”œâ”€ GEO ID + Title                 â”‚
â”‚    â”œâ”€ Quality badge (0.89)           â”‚
â”‚    â”œâ”€ Relevance score (0.94)         â”‚
â”‚    â”œâ”€ Organism, samples, year        â”‚
â”‚    â”œâ”€ Expandable summary             â”‚
â”‚    â””â”€ Action buttons:                â”‚
â”‚       â€¢ "Analyze with AI" ($0.04)    â”‚
â”‚       â€¢ "View Details"               â”‚
â”‚       â€¢ "Export"                     â”‚
â”‚ 5. Enable filters & sorting          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 2: GPT-4 Analysis Flow (Phase 4)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GPT-4 DATASET ANALYSIS WORKFLOW                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Clicks "Analyze with AI" on Dataset Card
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: Analysis Trigger           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Check user tier & quota           â”‚
â”‚    â€¢ AI operations: 18/20 remaining  â”‚
â”‚ 2. Show cost estimate: ~$0.04        â”‚
â”‚ 3. Confirm with user (optional)      â”‚
â”‚ 4. Show "Analyzing..." indicator     â”‚
â”‚    â€¢ Animated progress bar           â”‚
â”‚    â€¢ Estimated time: 13-15s          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ POST /api/agents/analyze
              â”‚ Headers: {
              â”‚   "Authorization": "Bearer eyJhbGc..."
              â”‚ }
              â”‚ Body: {
              â”‚   "geo_id": "GSE123456",
              â”‚   "analysis_depth": "comprehensive",
              â”‚   "user_query": "Focus on biomarkers"
              â”‚ }
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIDDLEWARE: Auth + Rate Limit Check                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Verify JWT token                                              â”‚
â”‚ 2. Check AI operation quota:                                     â”‚
â”‚    â€¢ Free tier: Max 5/hour                                       â”‚
â”‚    â€¢ Premium tier: Max 20/hour                                   â”‚
â”‚ 3. Check cost budget (if set)                                    â”‚
â”‚ 4. If OK: Continue to Analysis Agent                             â”‚
â”‚ 5. If exceeded: Return 429 with quota info                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Analysis Agent (GPT-4)                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 1. Fetch    â”‚ Get dataset metadata from cache/DB             â”‚
â”‚  â”‚   Dataset   â”‚ â€¢ Title, summary, organism, samples            â”‚
â”‚  â”‚  Metadata   â”‚ â€¢ Platform, protocol, publication              â”‚
â”‚  â”‚   (<500ms)  â”‚ â€¢ Quality score, citations                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 2. Build    â”‚ Construct GPT-4 prompt:                        â”‚
â”‚  â”‚   Prompt    â”‚                                                â”‚
â”‚  â”‚   (1-2s)    â”‚ System: "You are a biomedical research expert â”‚
â”‚  â”‚             â”‚          analyzing genomics datasets..."       â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚ User: "Analyze this dataset:                   â”‚
â”‚  â”‚             â”‚        - Title: RNA-seq of breast cancer...    â”‚
â”‚  â”‚             â”‚        - Organism: Homo sapiens                â”‚
â”‚  â”‚             â”‚        - Samples: 45 (tumor: 30, normal: 15)   â”‚
â”‚  â”‚             â”‚        - Platform: Illumina HiSeq              â”‚
â”‚  â”‚             â”‚        - Quality: 0.89/1.0                     â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚        Provide:                                â”‚
â”‚  â”‚             â”‚        1. Research context & significance      â”‚
â”‚  â”‚             â”‚        2. Methodology assessment               â”‚
â”‚  â”‚             â”‚        3. Key findings & biomarkers            â”‚
â”‚  â”‚             â”‚        4. Clinical relevance                   â”‚
â”‚  â”‚             â”‚        5. Limitations                          â”‚
â”‚  â”‚             â”‚        6. Future directions                    â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚        User focus: Biomarkers"                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 3. Call     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚   GPT-4     â”‚â”€â”¤  OpenAI API     â”‚                           â”‚
â”‚  â”‚   API       â”‚ â”‚  (GPT-4)        â”‚                           â”‚
â”‚  â”‚ (13-15s)    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚             â”‚          â”‚                                     â”‚
â”‚  â”‚             â”‚   Settings:                                    â”‚
â”‚  â”‚             â”‚   â€¢ model: "gpt-4"                             â”‚
â”‚  â”‚             â”‚   â€¢ max_tokens: 2000                           â”‚
â”‚  â”‚             â”‚   â€¢ temperature: 0.7                           â”‚
â”‚  â”‚             â”‚   â€¢ top_p: 0.9                                 â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚   Retry logic:                                 â”‚
â”‚  â”‚             â”‚   â€¢ 3 attempts                                 â”‚
â”‚  â”‚             â”‚   â€¢ Exponential backoff                        â”‚
â”‚  â”‚             â”‚   â€¢ Fallback to GPT-3.5-turbo on failure       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚ GPT-4 Response (13.2s):                               â”‚
â”‚         â”‚ {                                                      â”‚
â”‚         â”‚   "choices": [{                                        â”‚
â”‚         â”‚     "message": {                                       â”‚
â”‚         â”‚       "content": "# Research Context\n\nThis study... â”‚
â”‚         â”‚         ...comprehensive analysis shows...\n\n         â”‚
â”‚         â”‚         # Key Biomarkers\n- BRCA1 (downreg...        â”‚
â”‚         â”‚     },                                                 â”‚
â”‚         â”‚     "finish_reason": "stop"                            â”‚
â”‚         â”‚   }],                                                  â”‚
â”‚         â”‚   "usage": {                                           â”‚
â”‚         â”‚     "prompt_tokens": 523,                              â”‚
â”‚         â”‚     "completion_tokens": 1324,                         â”‚
â”‚         â”‚     "total_tokens": 1847                               â”‚
â”‚         â”‚   }                                                    â”‚
â”‚         â”‚ }                                                      â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 4. Parse &  â”‚ Extract structured insights:                   â”‚
â”‚  â”‚   Structure â”‚                                                â”‚
â”‚  â”‚   (<1s)     â”‚ â€¢ Overview summary                             â”‚
â”‚  â”‚             â”‚ â€¢ Key findings (5 bullets)                     â”‚
â”‚  â”‚             â”‚ â€¢ Biomarkers with confidence:                  â”‚
â”‚  â”‚             â”‚   - BRCA1 (0.92, diagnostic)                   â”‚
â”‚  â”‚             â”‚   - TP53 (0.87, prognostic)                    â”‚
â”‚  â”‚             â”‚   - PD-L1 (0.85, therapeutic)                  â”‚
â”‚  â”‚             â”‚ â€¢ Clinical relevance paragraph                 â”‚
â”‚  â”‚             â”‚ â€¢ Limitations (3 points)                       â”‚
â”‚  â”‚             â”‚ â€¢ Future directions (3 points)                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. Calculateâ”‚ Cost tracking:                                 â”‚
â”‚  â”‚    Cost &   â”‚ â€¢ Total tokens: 1847                           â”‚
â”‚  â”‚   Metadata  â”‚ â€¢ Cost: $0.037 (GPT-4 pricing)                â”‚
â”‚  â”‚   (<100ms)  â”‚ â€¢ Processing time: 13.2s                       â”‚
â”‚  â”‚             â”‚ â€¢ Model: gpt-4                                 â”‚
â”‚  â”‚             â”‚ â€¢ Confidence: 0.87                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 6. Cache &  â”‚ Store in Redis (60 min TTL)                   â”‚
â”‚  â”‚    Log      â”‚ Log to analytics:                              â”‚
â”‚  â”‚   (<100ms)  â”‚ â€¢ User ID, dataset ID                          â”‚
â”‚  â”‚             â”‚ â€¢ Tokens used, cost                            â”‚
â”‚  â”‚             â”‚ â€¢ Processing time                              â”‚
â”‚  â”‚             â”‚ â€¢ Timestamp                                    â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚ Update user stats:                             â”‚
â”‚  â”‚             â”‚ â€¢ Total AI operations: 19                      â”‚
â”‚  â”‚             â”‚ â€¢ Total cost: $0.71                            â”‚
â”‚  â”‚             â”‚ â€¢ Remaining quota: 1                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Response (14.5s total):
          â”‚ {
          â”‚   "status": "success",
          â”‚   "analysis": {
          â”‚     "summary": "This study examines RNA expression...",
          â”‚     "key_findings": [
          â”‚       "BRCA1 significantly downregulated...",
          â”‚       "TP53 pathway enrichment detected...",
          â”‚       "Immune cell infiltration correlates...",
          â”‚       "Novel therapeutic targets identified...",
          â”‚       "Strong correlation with clinical outcomes"
          â”‚     ],
          â”‚     "biomarkers": [
          â”‚       {
          â”‚         "gene": "BRCA1",
          â”‚         "confidence": 0.92,
          â”‚         "type": "diagnostic",
          â”‚         "context": "Significantly downregulated..."
          â”‚       },
          â”‚       {
          â”‚         "gene": "TP53",
          â”‚         "confidence": 0.87,
          â”‚         "type": "prognostic",
          â”‚         "context": "Pathway enrichment..."
          â”‚       },
          â”‚       {
          â”‚         "gene": "PD-L1",
          â”‚         "confidence": 0.85,
          â”‚         "type": "therapeutic",
          â”‚         "context": "Immunotherapy target..."
          â”‚       }
          â”‚     ],
          â”‚     "clinical_relevance": "Identified biomarkers...",
          â”‚     "limitations": [
          â”‚       "Limited sample size for subgroup analysis",
          â”‚       "Single platform validation needed",
          â”‚       "Batch effects not fully characterized"
          â”‚     ],
          â”‚     "future_directions": [
          â”‚       "Validate in independent cohort",
          â”‚       "Functional studies of BRCA1",
          â”‚       "Clinical trial design for PD-L1"
          â”‚     ],
          â”‚     "confidence_score": 0.87
          â”‚   },
          â”‚   "metadata": {
          â”‚     "model": "gpt-4",
          â”‚     "tokens_used": 1847,
          â”‚     "cost": 0.037,
          â”‚     "processing_time": 14.5,
          â”‚     "timestamp": "2025-10-08T10:15:32Z"
          â”‚   },
          â”‚   "usage": {
          â”‚     "remaining_quota": 1,
          â”‚     "total_cost_today": 0.71,
          â”‚     "total_analyses_today": 19
          â”‚   }
          â”‚ }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: LLMAnalysisPanel           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Hide "Analyzing..." indicator        â”‚
â”‚                                      â”‚
â”‚ Render analysis panel (expandable): â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸ¤– AI Analysis (87% confident) â”‚  â”‚
â”‚ â”‚ Cost: $0.04 | Time: 14.5s      â”‚  â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ“‹ Summary:                    â”‚  â”‚
â”‚ â”‚ This study examines RNA...     â”‚  â”‚
â”‚ â”‚ [Read more â–¼]                  â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ’¡ Key Findings:               â”‚  â”‚
â”‚ â”‚ â€¢ BRCA1 significantly down...  â”‚  â”‚
â”‚ â”‚ â€¢ TP53 pathway enrichment...   â”‚  â”‚
â”‚ â”‚ â€¢ Immune cell infiltration...  â”‚  â”‚
â”‚ â”‚ â€¢ Novel therapeutic targets... â”‚  â”‚
â”‚ â”‚ â€¢ Strong clinical outcomes...  â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ§¬ Biomarkers (3 identified):  â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ â”‚ BRCA1                    â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Type: Diagnostic       â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Confidence: 92%        â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Context: Downregulated â”‚  â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ â”‚ TP53                     â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Type: Prognostic       â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Confidence: 87%        â”‚  â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ â”‚ PD-L1                    â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Type: Therapeutic      â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ Confidence: 85%        â”‚  â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ¥ Clinical Relevance:         â”‚  â”‚
â”‚ â”‚ Identified biomarkers suggest..â”‚  â”‚
â”‚ â”‚ [Read more â–¼]                  â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ âš ï¸ Limitations:                â”‚  â”‚
â”‚ â”‚ â€¢ Limited sample size...       â”‚  â”‚
â”‚ â”‚ â€¢ Single platform...           â”‚  â”‚
â”‚ â”‚ â€¢ Batch effects...             â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ï¿½ Future Directions:          â”‚  â”‚
â”‚ â”‚ â€¢ Validate in cohort...        â”‚  â”‚
â”‚ â”‚ â€¢ Functional studies...        â”‚  â”‚
â”‚ â”‚ â€¢ Clinical trial design...     â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚ â”‚ ğŸ’° Your Usage Today:           â”‚  â”‚
â”‚ â”‚ â€¢ Analyses: 19/20              â”‚  â”‚
â”‚ â”‚ â€¢ Total cost: $0.71            â”‚  â”‚
â”‚ â”‚ â€¢ Remaining: 1 analysis        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 3: Q&A Interaction (Phase 4)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GPT-4 Q&A WORKFLOW (Phase 4)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Types Question: "What are the key biomarkers for diagnosis?"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: QAPanel Component          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 1. Capture question                  â”‚
â”‚ 2. Extract context from current      â”‚
â”‚    dataset or search results         â”‚
â”‚ 3. Show cost estimate: ~$0.01        â”‚
â”‚ 4. Show "Thinking..." animation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ POST /api/agents/qa
              â”‚ Headers: {
              â”‚   "Authorization": "Bearer eyJhbGc..."
              â”‚ }
              â”‚ Body: {
              â”‚   "question": "What are the key biomarkers...",
              â”‚   "geo_id": "GSE123456",  // Optional
              â”‚   "context": [
              â”‚     {
              â”‚       "title": "RNA-seq of breast cancer...",
              â”‚       "summary": "This study identifies..."
              â”‚     }
              â”‚   ],
              â”‚   "max_sources": 5
              â”‚ }
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Q&A Agent Service (GPT-4)                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 1. Process  â”‚ Parse question                                 â”‚
â”‚  â”‚  Question   â”‚ Extract entities: "biomarkers", "diagnosis"    â”‚
â”‚  â”‚   (<500ms)  â”‚ Classify intent: "information_extraction"      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 2. Build    â”‚ Create RAG (Retrieval-Augmented Gen) context: â”‚
â”‚  â”‚    RAG      â”‚                                                â”‚
â”‚  â”‚  Context    â”‚ If geo_id provided:                            â”‚
â”‚  â”‚   (1-2s)    â”‚ â€¢ Fetch dataset metadata                       â”‚
â”‚  â”‚             â”‚ â€¢ Include analysis if exists                   â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚ Combine context sources:                       â”‚
â”‚  â”‚             â”‚ â€¢ Dataset summaries                            â”‚
â”‚  â”‚             â”‚ â€¢ Previous AI analyses                         â”‚
â”‚  â”‚             â”‚ â€¢ Relevant literature excerpts                 â”‚
â”‚  â”‚             â”‚ Rank by relevance to question                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 3. Generate â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚   Answer    â”‚â”€â”¤ GPT-4 API       â”‚                           â”‚
â”‚  â”‚  (8-12s)    â”‚ â”‚ (~450 tokens)   â”‚                           â”‚
â”‚  â”‚             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚             â”‚          â”‚                                     â”‚
â”‚  â”‚             â”‚    Prompt: "Based on the dataset:              â”‚
â”‚  â”‚             â”‚     Answer: What are the key biomarkers...     â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚     Context:                                   â”‚
â”‚  â”‚             â”‚     - Title: RNA-seq of breast cancer...       â”‚
â”‚  â”‚             â”‚     - Findings: BRCA1 downregulated...         â”‚
â”‚  â”‚             â”‚     - Analysis: TP53 pathway enriched...       â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚     Provide answer with:                       â”‚
â”‚  â”‚             â”‚     1. Direct answer                           â”‚
â”‚  â”‚             â”‚     2. Supporting evidence                     â”‚
â”‚  â”‚             â”‚     3. Source citations"                       â”‚
â”‚  â”‚             â”‚                                                â”‚
â”‚  â”‚             â”‚   Response:                                    â”‚
â”‚  â”‚             â”‚   "Based on the dataset, the key diagnostic    â”‚
â”‚  â”‚             â”‚    biomarkers are:                             â”‚
â”‚  â”‚             â”‚    1. BRCA1 (downregulated, 92% confidence)    â”‚
â”‚  â”‚             â”‚    2. TP53 (pathway enrichment, 87% conf.)     â”‚
â”‚  â”‚             â”‚    3. PD-L1 (therapeutic target, 85% conf.)"   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 4. Cite     â”‚ Link answer segments to source datasets:      â”‚
â”‚  â”‚   Sources   â”‚                                                â”‚
â”‚  â”‚   (<500ms)  â”‚ "BRCA1 downregulated" â†’ GSE123456             â”‚
â”‚  â”‚             â”‚ "TP53 pathway" â†’ Previous analysis            â”‚
â”‚  â”‚             â”‚ "PD-L1 therapeutic" â†’ Literature              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. Calculateâ”‚ Confidence: 0.89 (high)                       â”‚
â”‚  â”‚ Confidence  â”‚ Based on: # sources, consistency, coverage    â”‚
â”‚  â”‚  & Cost     â”‚ Cost: ~$0.009 (450 tokens)                    â”‚
â”‚  â”‚   (<100ms)  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 6. Generate â”‚ Suggest related questions:                    â”‚
â”‚  â”‚  Follow-ups â”‚ â€¢ "What are the prognostic biomarkers?"       â”‚
â”‚  â”‚   (<500ms)  â”‚ â€¢ "How were these biomarkers validated?"      â”‚
â”‚  â”‚             â”‚ â€¢ "What are the therapeutic implications?"    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Response (10.2s):
          â”‚ {
          â”‚   "status": "success",
          â”‚   "answer": "Based on the dataset, the key diagnostic biomarkers are:\n\n1. **BRCA1** (downregulated, 92% confidence)\n   - Significantly lower expression in tumor samples\n   - Strong correlation with clinical diagnosis\n\n2. **TP53** (pathway enrichment, 87% confidence)\n   - TP53 signaling pathway shows enrichment\n   - Associated with tumor progression\n\n3. **PD-L1** (therapeutic target, 85% confidence)\n   - Expressed in immune cells\n   - Potential immunotherapy target",
          â”‚   "sources": [
          â”‚     {
          â”‚       "dataset_id": "GSE123456",
          â”‚       "title": "RNA-seq of breast cancer...",
          â”‚       "relevance_score": 0.94,
          â”‚       "excerpt": "BRCA1 was significantly downregulated..."
          â”‚     },
          â”‚     {
          â”‚       "source_type": "previous_analysis",
          â”‚       "excerpt": "TP53 pathway enrichment detected...",
          â”‚       "relevance_score": 0.91
          â”‚     }
          â”‚   ],
          â”‚   "confidence": 0.89,
          â”‚   "follow_up_questions": [
          â”‚     "What are the prognostic biomarkers?",
          â”‚     "How were these biomarkers validated?",
          â”‚     "What are the therapeutic implications?"
          â”‚   ],
          â”‚   "metadata": {
          â”‚     "model": "gpt-4",
          â”‚     "tokens_used": 453,
          â”‚     "cost": 0.009,
          â”‚     "processing_time": 10.2
          â”‚   }
          â”‚ }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: QAPanel Display            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Hide "Thinking..." animation         â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Q: What are the key biomarkers â”‚  â”‚
â”‚ â”‚    for diagnosis?              â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ¤– Answer (89% confident):     â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ Based on the dataset, the key  â”‚  â”‚
â”‚ â”‚ diagnostic biomarkers are:     â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ 1. BRCA1 (downregulated, 92%)  â”‚  â”‚
â”‚ â”‚    â€¢ Lower in tumor samples    â”‚  â”‚
â”‚ â”‚    â€¢ Strong clinical corr.     â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ 2. TP53 (pathway enrich., 87%) â”‚  â”‚
â”‚ â”‚    â€¢ Signaling enriched        â”‚  â”‚
â”‚ â”‚    â€¢ Tumor progression         â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ 3. PD-L1 (therapeutic, 85%)    â”‚  â”‚
â”‚ â”‚    â€¢ Expressed in immune       â”‚  â”‚
â”‚ â”‚    â€¢ Immunotherapy target      â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ“š Sources (2):                â”‚  â”‚
â”‚ â”‚ â€¢ GSE123456 (94% relevant)     â”‚  â”‚
â”‚ â”‚ â€¢ Previous analysis (91%)      â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ’¡ Related questions:          â”‚  â”‚
â”‚ â”‚ â€¢ What are prognostic markers? â”‚  â”‚
â”‚ â”‚ â€¢ How were these validated?    â”‚  â”‚
â”‚ â”‚ â€¢ Therapeutic implications?    â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ’° Cost: $0.01 | Time: 10.2s   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚ User can click sources or questions  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 4. Cite     â”‚ Link answer segments to source papers:        â”‚
â”‚  â”‚   Sources   â”‚                                                â”‚
â”‚  â”‚             â”‚ "Lipid nanoparticles" â†’ Smith 2023            â”‚
â”‚  â”‚             â”‚ "Viral vectors" â†’ Doe 2022                    â”‚
â”‚  â”‚             â”‚ "Electroporation" â†’ Lee 2023                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. Calculateâ”‚ Confidence: 0.87 (high)                       â”‚
â”‚  â”‚ Confidence  â”‚ Based on: # sources, consistency, coverage    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 6. Generate â”‚ Suggest related questions:                    â”‚
â”‚  â”‚  Follow-ups â”‚ â€¢ "How effective are these mechanisms?"       â”‚
â”‚  â”‚             â”‚ â€¢ "Which is best for in vivo delivery?"       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Response (1.8s):
          â”‚ {
          â”‚   "status": "success",
          â”‚   "answer": "The papers discuss three main...",
          â”‚   "sources": [
          â”‚     {
          â”‚       "title": "Novel CRISPR delivery...",
          â”‚       "relevance_score": 0.94,
          â”‚       "excerpt": "We developed lipid..."
          â”‚     },
          â”‚     ...
          â”‚   ],
          â”‚   "confidence": 0.87,
          â”‚   "follow_up_questions": [...]
          â”‚ }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: QAPanel Display            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Hide "Thinking..." animation         â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Q: What delivery mechanisms    â”‚  â”‚
â”‚ â”‚    are discussed?              â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ¤– Answer (87% confident):     â”‚  â”‚
â”‚ â”‚ The papers discuss three main  â”‚  â”‚
â”‚ â”‚ delivery mechanisms:           â”‚  â”‚
â”‚ â”‚ 1. Lipid nanoparticles         â”‚  â”‚
â”‚ â”‚ 2. Viral vectors               â”‚  â”‚
â”‚ â”‚ 3. Electroporation             â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ“š Sources:                    â”‚  â”‚
â”‚ â”‚ â€¢ Smith et al. 2023 (94%)      â”‚  â”‚
â”‚ â”‚ â€¢ Doe et al. 2022 (89%)        â”‚  â”‚
â”‚ â”‚ â€¢ Lee et al. 2023 (86%)        â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚
â”‚ â”‚ ğŸ’¡ Related questions:          â”‚  â”‚
â”‚ â”‚ â€¢ How effective are these...?  â”‚  â”‚
â”‚ â”‚ â€¢ Which is best for in vivo...?â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚ User can click sources to view papersâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Feature Integration Points (Phase 4)

### Complete Feature Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEATURE RENDERING MAP (Phase 4)                    â”‚
â”‚                                                                      â”‚
â”‚  Backend Data         API Endpoint           Frontend Component     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                      â”‚
â”‚  0. Authentication    /api/auth/*       â†’    LoginForm/UserMenu    â”‚
â”‚     â”œâ”€ Login                                  â”œâ”€ Email/password    â”‚
â”‚     â”œâ”€ Register                               â”œâ”€ Signup form       â”‚
â”‚     â”œâ”€ Tokens (JWT)                           â”œâ”€ Token storage     â”‚
â”‚     â””â”€ User info                              â””â”€ Profile display   â”‚
â”‚                                                                      â”‚
â”‚  1. Datasets          /api/search/      â†’    ResultCard            â”‚
â”‚     â”œâ”€ GEO ID              datasets           â”œâ”€ Header (GEO ID)   â”‚
â”‚     â”œâ”€ Title                                  â”œâ”€ Title + quality   â”‚
â”‚     â”œâ”€ Organism                               â”œâ”€ Metadata row      â”‚
â”‚     â”œâ”€ Samples                                â”œâ”€ Expandable        â”‚
â”‚     â””â”€ Summary                                â””â”€ Action buttons    â”‚
â”‚                                                                      â”‚
â”‚  2. Quality Score     (in results)      â†’    QualityBadge          â”‚
â”‚     â”œâ”€ Overall (0-1)                          â”œâ”€ Star rating (0-5) â”‚
â”‚     â”œâ”€ Components                             â”œâ”€ Percentage        â”‚
â”‚     â”œâ”€ Confidence                             â”œâ”€ Color (red/green) â”‚
â”‚     â””â”€ Factors                                â””â”€ Tooltip details   â”‚
â”‚                                                                      â”‚
â”‚  3. Citations         /api/analysis/    â†’    CitationPanel         â”‚
â”‚     â”œâ”€ Count              citations           â”œâ”€ Summary metrics   â”‚
â”‚     â”œâ”€ Network                                â”œâ”€ Network graph     â”‚
â”‚     â”œâ”€ Co-citations                           â”œâ”€ Related papers    â”‚
â”‚     â””â”€ Trends                                 â””â”€ Citation chart    â”‚
â”‚                                                                      â”‚
â”‚  4. Biomarkers        (in AI analysis)  â†’    BiomarkerPanel        â”‚
â”‚     â”œâ”€ Gene name                              â”œâ”€ Category groups   â”‚
â”‚     â”œâ”€ Type (diag/prog)                       â”œâ”€ Type badge        â”‚
â”‚     â”œâ”€ Confidence                             â”œâ”€ Confidence %      â”‚
â”‚     â””â”€ Context                                â””â”€ Evidence text     â”‚
â”‚                                                                      â”‚
â”‚  5. GPT-4 Analysis    /api/agents/      â†’    LLMAnalysisPanel      â”‚
â”‚     â”œâ”€ Summary             analyze            â”œâ”€ Summary card      â”‚
â”‚     â”œâ”€ Key findings                           â”œâ”€ Bullet list       â”‚
â”‚     â”œâ”€ Biomarkers                             â”œâ”€ Biomarker cards   â”‚
â”‚     â”œâ”€ Clinical rel.                          â”œâ”€ Clinical section  â”‚
â”‚     â”œâ”€ Limitations                            â”œâ”€ Warning list      â”‚
â”‚     â”œâ”€ Future dirs.                           â”œâ”€ Action items      â”‚
â”‚     â”œâ”€ Cost                                   â””â”€ Cost/time display â”‚
â”‚     â””â”€ Tokens                                                       â”‚
â”‚                                                                      â”‚
â”‚  6. Q&A (GPT-4)       /api/agents/qa    â†’    QAPanel               â”‚
â”‚     â”œâ”€ Answer                                 â”œâ”€ Answer text       â”‚
â”‚     â”œâ”€ Sources                                â”œâ”€ Source links      â”‚
â”‚     â”œâ”€ Confidence                             â”œâ”€ Confidence bar    â”‚
â”‚     â”œâ”€ Follow-ups                             â”œâ”€ Suggestion chips  â”‚
â”‚     â””â”€ Cost                                   â””â”€ Cost display      â”‚
â”‚                                                                      â”‚
â”‚  7. Relevance Score   (in results)      â†’    RelevanceBadge        â”‚
â”‚     â”œâ”€ Score (0-1)                            â”œâ”€ Relevance %       â”‚
â”‚     â”œâ”€ Matched terms                          â”œâ”€ Matched keywords  â”‚
â”‚     â””â”€ Method                                 â””â”€ Info tooltip      â”‚
â”‚                                                                      â”‚
â”‚  8. Trends            /api/analysis/    â†’    TrendsChart           â”‚
â”‚     â”œâ”€ Timeline            trends             â”œâ”€ Line chart        â”‚
â”‚     â”œâ”€ Topic evolution                        â”œâ”€ Bar chart         â”‚
â”‚     â”œâ”€ Emerging topics                        â”œâ”€ Emerging badges   â”‚
â”‚     â””â”€ Clusters                               â””â”€ Cluster view      â”‚
â”‚                                                                      â”‚
â”‚  9. Recommendations   /api/agents/      â†’    RecommendationsPanel  â”‚
â”‚     â”œâ”€ Related datasets    recommend          â”œâ”€ Dataset cards     â”‚
â”‚     â”œâ”€ Similarity score                       â”œâ”€ Similarity %      â”‚
â”‚     â”œâ”€ Relationship                           â”œâ”€ Relationship tag  â”‚
â”‚     â””â”€ Citation network                       â””â”€ Network viz       â”‚
â”‚                                                                      â”‚
â”‚  10. Export           /api/export       â†’    Export Button         â”‚
â”‚      â”œâ”€ Format (CSV/JSON)                     â”œâ”€ Format selector   â”‚
â”‚      â”œâ”€ Datasets                              â”œâ”€ Download trigger  â”‚
â”‚      â”œâ”€ Analysis                              â”œâ”€ Progress bar      â”‚
â”‚      â””â”€ Quality scores                        â””â”€ Status display    â”‚
â”‚                                                                      â”‚
â”‚  11. Analytics        /api/analytics/   â†’    AnalyticsDashboard    â”‚
â”‚      â”œâ”€ Usage stats        user              â”œâ”€ Usage charts      â”‚
â”‚      â”œâ”€ Costs (AI)                            â”œâ”€ Cost breakdown    â”‚
â”‚      â”œâ”€ Quota remaining                       â”œâ”€ Quota gauge       â”‚
â”‚      â””â”€ Search history                        â””â”€ History list      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ State Management Flow (Phase 4)

### Global State Structure

```
Application State (Phase 4)
â”œâ”€ AuthState (NEW)
â”‚  â”œâ”€ isAuthenticated: boolean
â”‚  â”œâ”€ accessToken: string | null
â”‚  â”œâ”€ refreshToken: string | null
â”‚  â”œâ”€ user: {
â”‚  â”‚   â”œâ”€ id: string
â”‚  â”‚   â”œâ”€ email: string
â”‚  â”‚   â”œâ”€ tier: 'free' | 'premium' | 'admin'
â”‚  â”‚   â”œâ”€ rate_limit: number
â”‚  â”‚   â””â”€ created_at: string
â”‚  â”‚ }
â”‚  â””â”€ tokenExpiry: Date | null
â”‚
â”œâ”€ SearchState
â”‚  â”œâ”€ currentQuery: string
â”‚  â”œâ”€ filters: FilterObject {
â”‚  â”‚   â”œâ”€ organism: string | null
â”‚  â”‚   â”œâ”€ min_samples: number
â”‚  â”‚   â”œâ”€ quality_threshold: number (0.0-1.0)
â”‚  â”‚   â”œâ”€ date_range: [start, end]
â”‚  â”‚   â””â”€ enable_semantic: boolean
â”‚  â”‚ }
â”‚  â”œâ”€ history: Query[]
â”‚  â””â”€ suggestions: string[]
â”‚
â”œâ”€ ResultsState
â”‚  â”œâ”€ datasets: Dataset[] {
â”‚  â”‚   â”œâ”€ geo_id: string
â”‚  â”‚   â”œâ”€ title: string
â”‚  â”‚   â”œâ”€ quality_score: number (0.0-1.0)
â”‚  â”‚   â”œâ”€ relevance_score: number (0.0-1.0)
â”‚  â”‚   â”œâ”€ sample_count: number
â”‚  â”‚   â”œâ”€ organism: string
â”‚  â”‚   â””â”€ summary: string
â”‚  â”‚ }
â”‚  â”œâ”€ totalCount: number
â”‚  â”œâ”€ currentPage: number
â”‚  â”œâ”€ selectedIds: Set<string>
â”‚  â”œâ”€ sortBy: 'relevance' | 'quality' | 'date' | 'citations'
â”‚  â””â”€ cached: boolean
â”‚
â”œâ”€ AnalysisState (ENHANCED)
â”‚  â”œâ”€ llmAnalyses: Map<string, AnalysisResponse> {
â”‚  â”‚   â”œâ”€ summary: string
â”‚  â”‚   â”œâ”€ key_findings: string[]
â”‚  â”‚   â”œâ”€ biomarkers: Biomarker[]
â”‚  â”‚   â”œâ”€ clinical_relevance: string
â”‚  â”‚   â”œâ”€ limitations: string[]
â”‚  â”‚   â”œâ”€ future_directions: string[]
â”‚  â”‚   â”œâ”€ confidence_score: number (0.0-1.0)
â”‚  â”‚   â”œâ”€ tokens_used: number
â”‚  â”‚   â””â”€ cost: number
â”‚  â”‚ }
â”‚  â”œâ”€ qaHistory: QAInteraction[] {
â”‚  â”‚   â”œâ”€ question: string
â”‚  â”‚   â”œâ”€ answer: string
â”‚  â”‚   â”œâ”€ sources: Source[]
â”‚  â”‚   â”œâ”€ confidence: number
â”‚  â”‚   â”œâ”€ cost: number
â”‚  â”‚   â””â”€ timestamp: Date
â”‚  â”‚ }
â”‚  â”œâ”€ recommendations: Map<string, Recommendation[]>
â”‚  â”œâ”€ trends: TrendsResponse | null
â”‚  â””â”€ citations: CitationNetwork | null
â”‚
â”œâ”€ UIState
â”‚  â”œâ”€ expandedCards: Map<string, Set<string>>
â”‚  â”œâ”€ activeTab: string
â”‚  â”œâ”€ drawerOpen: boolean
â”‚  â”œâ”€ loading: Map<string, boolean> {
â”‚  â”‚   â”œâ”€ 'search': boolean
â”‚  â”‚   â”œâ”€ 'analysis_{geo_id}': boolean
â”‚  â”‚   â”œâ”€ 'qa': boolean
â”‚  â”‚   â””â”€ 'export': boolean
â”‚  â”‚ }
â”‚  â”œâ”€ errors: Error[]
â”‚  â””â”€ notifications: Notification[]
â”‚
â”œâ”€ UserState (ENHANCED)
â”‚  â”œâ”€ preferences: {
â”‚  â”‚   â”œâ”€ theme: 'light' | 'dark'
â”‚  â”‚   â”œâ”€ default_organism: string
â”‚  â”‚   â”œâ”€ quality_threshold: number
â”‚  â”‚   â””â”€ enable_semantic_default: boolean
â”‚  â”‚ }
â”‚  â”œâ”€ bookmarks: string[] // GEO IDs
â”‚  â”œâ”€ workspaces: Workspace[]
â”‚  â”œâ”€ usage: {
â”‚  â”‚   â”œâ”€ searches_today: number
â”‚  â”‚   â”œâ”€ ai_operations_today: number
â”‚  â”‚   â”œâ”€ total_cost_today: number
â”‚  â”‚   â”œâ”€ quota_remaining: number
â”‚  â”‚   â””â”€ last_reset: Date
â”‚  â”‚ }
â”‚  â””â”€ settings: Settings
â”‚
â””â”€ CacheState (NEW)
   â”œâ”€ searchResults: Map<string, CachedSearch>
   â”œâ”€ analyses: Map<string, CachedAnalysis>
   â”œâ”€ ttl: Map<string, Date>
   â””â”€ cacheHits: number
```

### State Update Flow

```
User Action â†’ Event Handler â†’ State Update â†’ UI Re-render

Example: User expands "AI Analysis" in card #3

1. User clicks "AI Analysis" button
   â†“
2. onClick handler fires:
   expandCard(cardId='3', section='llm_analysis')
   â†“
3. Check if data exists:
   if (!state.results[3].llm_analysis) {
     fetchLLMAnalysis(cardId='3')
   }
   â†“
4. Update UI state:
   state.ui.expandedCards.set('3', new Set(['llm_analysis']))
   â†“
5. Trigger re-render:
   ResultCard #3 re-renders with expanded section
   â†“
6. If fetch needed:
   a. Show loading spinner in expanded section
   b. Call API: POST /agents/analyze
   c. Update results state with response
   d. Hide loading spinner
   e. Display LLM analysis
```

---

## ğŸ“± Responsive Layout Flow

### Desktop â†’ Tablet â†’ Mobile

```
DESKTOP (>1024px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: Logo | Search | Filters | User                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ Sidebar â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ (20%)     â”‚  â”‚ (80%)                                  â”‚  â”‚
â”‚ â”‚           â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚ Filters   â”‚  â”‚ [ResultCard][ResultCard][ResultCard]  â”‚  â”‚
â”‚ â”‚ History   â”‚  â”‚ [ResultCard][ResultCard][ResultCard]  â”‚  â”‚
â”‚ â”‚ Saved     â”‚  â”‚ [ResultCard][ResultCard][ResultCard]  â”‚  â”‚
â”‚ â”‚           â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚ AI Panel  â”‚  â”‚ â”Œâ”€ Analysis Drawer (collapsible) â”€â”€â”€â” â”‚  â”‚
â”‚ â”‚ (inline)  â”‚  â”‚ â”‚ [LLM][Viz][Analytics][Network]    â”‚ â”‚  â”‚
â”‚ â”‚           â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TABLET (768-1024px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: Logo | Search | â˜° Menu                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Main Content (100%)                                 â”‚    â”‚
â”‚ â”‚                                                     â”‚    â”‚
â”‚ â”‚ [ResultCard  ] [ResultCard  ]                      â”‚    â”‚
â”‚ â”‚ [ResultCard  ] [ResultCard  ]                      â”‚    â”‚
â”‚ â”‚                                                     â”‚    â”‚
â”‚ â”‚ â”Œâ”€ Filters (collapsible) â”€â”                        â”‚    â”‚
â”‚ â”‚ â”‚ [Filters slide in]       â”‚                        â”‚    â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚    â”‚
â”‚ â”‚                                                     â”‚    â”‚
â”‚ â”‚ â”Œâ”€ Analysis Drawer (bottom) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚ â”‚ â”‚ [Full width, slides up]                        â”‚ â”‚    â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MOBILE (<768px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜° [Search____________] ğŸ”        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ResultCard (full width)      â”‚ â”‚
â”‚ â”‚ â€¢ Stacked layout             â”‚ â”‚
â”‚ â”‚ â€¢ Tap to expand              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ResultCard                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ [Load More â†“]                    â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€ Analysis (bottom sheet) â”€â”€â”€â” â”‚
â”‚ â”‚ Swipe up to view             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Error Handling Flow

### Graceful Degradation

```
API Call Scenarios:

â”Œâ”€ SCENARIO 1: Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â†’ 200 OK â†’ Parse JSON â†’ Update State â†’ Render   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SCENARIO 2: Timeout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â†’ Timeout (30s) â†’ Show warning message           â”‚
â”‚         â†’ Display partial results (if any)               â”‚
â”‚         â†’ Offer retry button                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SCENARIO 3: Server Error (500) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â†’ 500 Error â†’ Log error                          â”‚
â”‚         â†’ Show user-friendly message                     â”‚
â”‚         â†’ Suggest alternatives (e.g., try fewer filters) â”‚
â”‚         â†’ Enable error reporting                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SCENARIO 4: No Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â†’ 200 OK â†’ results = [] â†’ Show empty state       â”‚
â”‚         â†’ Suggest query modifications                    â”‚
â”‚         â†’ Show related searches                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SCENARIO 5: Partial Failure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â†’ Some features fail (e.g., LLM timeout)         â”‚
â”‚         â†’ Show available data                            â”‚
â”‚         â†’ Indicate which features are unavailable        â”‚
â”‚         â†’ Continue with reduced functionality            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Performance Optimization

### Loading Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PROGRESSIVE LOADING STRATEGY                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Initial Page Load (0-500ms)
â”œâ”€ Load: HTML, CSS, JavaScript frameworks
â”œâ”€ Show: Header, search bar
â””â”€ State: Ready to search

User Searches (0-100ms)
â”œâ”€ Show: Loading skeletons (10 cards)
â”œâ”€ Disable: Search button (prevent duplicate)
â””â”€ Start: API request

Search Results Arrive (1-3s)
â”œâ”€ Hide: Skeletons
â”œâ”€ Render: Core data (title, authors, year, citations)
â”œâ”€ Lazy load: Abstracts (on expand)
â”œâ”€ Lazy load: LLM analysis (on demand)
â””â”€ Enable: User interactions

Background Tasks (async)
â”œâ”€ Prefetch: Next page of results
â”œâ”€ Cache: Search in browser
â”œâ”€ Warm up: LLM model (if idle)
â””â”€ Log: Analytics events

On Scroll (lazy)
â”œâ”€ Load: Images, charts (when visible)
â”œâ”€ Render: Off-screen cards (virtualization)
â””â”€ Prefetch: Adjacent pages
```

---

## ğŸ“Š Data Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CACHING LAYERS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 1: Browser Memory Cache (fastest)
â”œâ”€ Store: Current search results
â”œâ”€ TTL: Until page refresh
â””â”€ Use: Instant filter/sort without API calls

LAYER 2: Browser LocalStorage (persistent)
â”œâ”€ Store: Search history, preferences, bookmarks
â”œâ”€ TTL: 30 days
â””â”€ Use: Autocomplete, saved searches

LAYER 3: Redis Cache (server-side)
â”œâ”€ Store: Search results, LLM analyses
â”œâ”€ TTL: 1 hour (configurable)
â””â”€ Use: Avoid duplicate API calls across users

LAYER 4: Database (permanent)
â”œâ”€ Store: User data, workspaces
â”œâ”€ TTL: Indefinite
â””â”€ Use: User authentication, saved work

Cache Invalidation:
â”œâ”€ Manual: User clicks "Refresh"
â”œâ”€ Time-based: TTL expires
â”œâ”€ Event-based: New publication indexed
â””â”€ Version-based: API schema changes
```

---

## ğŸš€ Quick Reference: Framework Migration

### What Changes vs What Stays

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             FRAMEWORK AGNOSTIC (Backend)                  â”‚
â”‚                    âœ… NEVER CHANGES                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ API endpoints: /api/v1/search/search
â€¢ Response schemas: SearchResponse, AnalysisResponse
â€¢ Business logic: Search, analysis, ML
â€¢ Database: Publication storage
â€¢ External APIs: PubMed, Scholar integration

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FRAMEWORK SPECIFIC (Frontend)                   â”‚
â”‚                  ğŸ”„ CHANGES PER FRAMEWORK                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ Component syntax: JSX (React) vs SFC (Vue) vs Svelte
â€¢ State management: useState vs ref() vs stores
â€¢ Routing: React Router vs Vue Router
â€¢ Build tools: Vite vs Next.js vs CRA
â€¢ CSS approach: Tailwind vs CSS Modules vs Styled Components

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                REUSABLE ACROSS FRAMEWORKS                 â”‚
â”‚                   â™»ï¸ WRITE ONCE, USE EVERYWHERE          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ API client: fetch() calls in vanilla JS/TS
â€¢ TypeScript types: Interface definitions
â€¢ Design tokens: JSON/CSS variables
â€¢ Business logic: Pure functions
â€¢ Test data: Mock responses
```

---

## ğŸ“‹ Summary Checklist (Phase 4)

### For ANY New Frontend Implementation:

**Step 1: Setup**
- [ ] Review BACKEND_FRONTEND_CONTRACT.md
- [ ] Review this document (data flow)
- [ ] Review API_REFERENCE.md v3.0
- [ ] Choose framework (React/Vue/Svelte/Streamlit/etc.)
- [ ] Set up project structure

**Step 2: Authentication Integration (NEW)**
- [ ] Implement login/register UI
- [ ] JWT token storage (localStorage/secure cookie)
- [ ] Token refresh logic (automatic)
- [ ] Protected route handling
- [ ] User profile display
- [ ] Rate limit status display

**Step 3: API Integration**
- [ ] Create API client module with JWT auth
- [ ] Add TypeScript types from contract
- [ ] Implement error handling (401, 429, 500)
- [ ] Add request/response logging
- [ ] Implement retry logic for failed requests
- [ ] Add request interceptors for token injection

**Step 4: Core Components**
- [ ] Search input + advanced filters
  - [ ] Organism dropdown
  - [ ] Quality threshold slider (0.6-1.0)
  - [ ] Semantic search toggle
  - [ ] Sample size filter
- [ ] Result card (with expansion)
  - [ ] GEO ID + title
  - [ ] Quality badge (0-1 scale)
  - [ ] Relevance score
  - [ ] Metadata (organism, samples, year)
- [ ] Loading skeletons
- [ ] Empty/error states
- [ ] Rate limit warnings

**Step 5: AI Feature Components (NEW)**
- [ ] GPT-4 Analysis panel
  - [ ] Cost display (~$0.04)
  - [ ] Loading indicator (13-15s)
  - [ ] Summary, findings, biomarkers
  - [ ] Clinical relevance section
  - [ ] Limitations list
  - [ ] Token/cost tracking
- [ ] Q&A interface
  - [ ] Question input
  - [ ] Cost estimate (~$0.01)
  - [ ] Answer display with sources
  - [ ] Confidence score
  - [ ] Follow-up questions
- [ ] Quality score badges (0-5 stars)
- [ ] Biomarker cards (with confidence)
- [ ] Recommendation panel (related datasets)

**Step 6: State Management**
- [ ] Auth state (tokens, user, tier)
- [ ] Search state (query, filters, history)
- [ ] Results state (datasets, quality scores)
- [ ] Analysis state (AI responses, costs)
- [ ] UI state (loading, expanded, errors)
- [ ] User preferences
- [ ] Usage tracking (quota, costs)

**Step 7: Performance**
- [ ] Lazy loading (images, analyses)
- [ ] Virtual scrolling (large result sets)
- [ ] Caching strategy (browser + API)
- [ ] Code splitting (route-based)
- [ ] Debounced search input
- [ ] Optimistic UI updates

**Step 8: Cost Management (NEW)**
- [ ] Display AI operation costs
- [ ] Show quota remaining
- [ ] Daily/monthly cost tracking
- [ ] Confirm before expensive operations
- [ ] Cost breakdown by operation type

**Step 9: Testing**
- [ ] Unit tests (components, hooks)
- [ ] Integration tests (API calls, auth flow)
- [ ] E2E tests (user workflows)
- [ ] Performance tests (load times, caching)
- [ ] Cost/quota limit tests

**Step 10: Deployment**
- [ ] Environment variables (API URLs, keys)
- [ ] Build optimization
- [ ] Error tracking (Sentry, etc.)
- [ ] Analytics integration
- [ ] HTTPS/SSL setup

---

## âœ… Phase 4 Complete - What's New

### Major Changes from Phase 3:

1. **Authentication System** âœ…
   - JWT token-based authentication
   - User registration & login flows
   - Automatic token refresh
   - Protected routes & middleware
   - RBAC (free, premium, admin tiers)

2. **5-Agent System** âœ…
   - Query Agent: Entity extraction & intent
   - Search Agent: Hybrid search (20-30s)
   - Analysis Agent: GPT-4 analysis (13-15s, ~$0.04)
   - Quality Agent: Quality scoring (<1s)
   - Recommendation Agent: Related datasets (1-2s)

3. **GPT-4 Integration** âœ…
   - Comprehensive dataset analysis
   - Q&A with context
   - Biomarker extraction
   - Cost tracking & transparency
   - Token management

4. **Enhanced Caching** âœ…
   - 3-level caching (Redis, SQLite, File)
   - 60%+ cache hit rate
   - Reduced API calls & costs
   - Faster repeat searches (<1s)

5. **Quality Assessment** âœ…
   - Quality scoring (0.0-1.0)
   - Quality threshold filtering
   - Quality factor breakdown
   - Confidence scores

6. **Cost Management** âœ…
   - Per-operation cost tracking
   - Daily/monthly budgets
   - Quota management (100-1000 req/hour)
   - AI operation limits (5-20/hour)
   - Cost transparency in UI

7. **Enhanced API** âœ…
   - `/api/auth/*` - 5 endpoints
   - `/api/agents/*` - 5 endpoints
   - `/api/search/*` - 3 endpoints
   - `/api/analysis/*` - 3 endpoints
   - `/api/analytics/*` - 2 endpoints
   - `/api/export/*` - 3 endpoints

---

**This completes the Phase 4 visual data flow map! ğŸ‰**

You now have:
1. âœ… Phase 4 multi-agent system architecture
2. âœ… Authentication & authorization flows
3. âœ… GPT-4 integration workflows (analysis, Q&A)
4. âœ… Feature integration map with all Phase 4 endpoints
5. âœ… Enhanced state management (auth, costs, quotas)
6. âœ… Complete implementation checklist

**Ready to implement ANY frontend framework with Phase 4 features!** ğŸš€

**Last Updated:** October 8, 2025
**Version:** 2.0 (Phase 4 Complete)
**Status:** Production Ready
