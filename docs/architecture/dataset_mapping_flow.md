# Dataset-to-PDF Mapping Flow Diagram

**Visual representation of how OmicsOracle maintains correct mappings when downloading and analyzing datasets in any order**

---

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND (JavaScript)                           â”‚
â”‚                                                                          â”‚
â”‚  currentResults = [                                                      â”‚
â”‚    { geo_id: "GSE123456", fulltext: [], ... },  â† Index 0               â”‚
â”‚    { geo_id: "GSE789012", fulltext: [], ... },  â† Index 1               â”‚
â”‚    { geo_id: "GSE555555", fulltext: [], ... }   â† Index 2               â”‚
â”‚  ]                                                                       â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Card 0     â”‚   â”‚  Card 1     â”‚   â”‚  Card 2     â”‚                   â”‚
â”‚  â”‚ GSE123456   â”‚   â”‚ GSE789012   â”‚   â”‚ GSE555555   â”‚                   â”‚
â”‚  â”‚             â”‚   â”‚             â”‚   â”‚             â”‚                   â”‚
â”‚  â”‚ [Download]  â”‚   â”‚ [Download]  â”‚   â”‚ [Download]  â”‚                   â”‚
â”‚  â”‚ [AI Analyze]â”‚   â”‚ [AI Analyze]â”‚   â”‚ [AI Analyze]â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                  â”‚                  â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â”‚ onClick(0)       â”‚ onClick(1)       â”‚ onClick(2)
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND API (FastAPI)                               â”‚
â”‚                                                                          â”‚
â”‚  POST /enrich-fulltext                    POST /analyze                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Input: [dataset]    â”‚                  â”‚ Input: [dataset]    â”‚       â”‚
â”‚  â”‚ - geo_id            â”‚                  â”‚ - geo_id            â”‚       â”‚
â”‚  â”‚ - pubmed_ids        â”‚                  â”‚ - fulltext[]        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚             â”‚                                        â”‚                  â”‚
â”‚             â–¼                                        â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. Fetch metadata    â”‚                â”‚ 1. Check fulltext    â”‚       â”‚
â”‚  â”‚    for PMIDs         â”‚                â”‚    availability      â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ 2. Find PDF URLs     â”‚                â”‚ 2. Build prompt with â”‚       â”‚
â”‚  â”‚    from 11 sources   â”‚                â”‚    Methods/Results   â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ 3. Download PDFs     â”‚                â”‚ 3. Send to GPT-4     â”‚       â”‚
â”‚  â”‚    with retry logic  â”‚                â”‚    for analysis      â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ 4. Parse PDFs        â”‚                â”‚ 4. Return analysis   â”‚       â”‚
â”‚  â”‚    (extract sections)â”‚                â”‚    response          â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”‚ 5. Attach fulltext[] â”‚                           â”‚                  â”‚
â”‚  â”‚    to dataset        â”‚                           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                  â”‚
â”‚             â”‚                                        â”‚                  â”‚
â”‚             â”‚ Return enriched dataset                â”‚ Return analysis  â”‚
â”‚             â–¼                                        â–¼                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                        â”‚
          â”‚ Update currentResults[index]           â”‚ Display in card
          â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA STORAGE (File System)                         â”‚
â”‚                                                                          â”‚
â”‚  data/fulltext/pdfs/                                                     â”‚
â”‚  â”œâ”€â”€ PMID_12345.pdf  â† From GSE123456                                   â”‚
â”‚  â”œâ”€â”€ PMID_67890.pdf  â† From GSE123456                                   â”‚
â”‚  â”œâ”€â”€ PMID_11111.pdf  â† From GSE789012                                   â”‚
â”‚  â”œâ”€â”€ PMID_22222.pdf  â† From GSE789012                                   â”‚
â”‚  â”œâ”€â”€ PMID_33333.pdf  â† From GSE555555                                   â”‚
â”‚  â””â”€â”€ PMID_44444.pdf  â† From GSE555555                                   â”‚
â”‚                                                                          â”‚
â”‚  Each PDF filename is based on PMID (globally unique)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Sequence: Download Papers

### Scenario: User clicks "Download Papers" on Card 1 (GSE789012)

```
USER                 FRONTEND              BACKEND               DATABASE
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚ Click Download      â”‚                     â”‚                     â”‚
  â”‚ on Card 1          â”‚                     â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Get dataset object  â”‚                     â”‚
  â”‚                     â”‚ from currentResults[1]                    â”‚
  â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚
  â”‚                     â”‚ â”‚ geo_id: GSE789012â”‚                     â”‚
  â”‚                     â”‚ â”‚ pubmed_ids:      â”‚                     â”‚
  â”‚                     â”‚ â”‚   ["11111","22222"]                    â”‚
  â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ POST /enrich-fulltext                     â”‚
  â”‚                     â”‚ Body: [dataset]     â”‚                     â”‚
  â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Loop: for dataset in datasets:
  â”‚                     â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                     â”‚                     â”‚ â”‚ dataset.geo_id  â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚ = "GSE789012"   â”‚ â”‚
  â”‚                     â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Fetch PubMed metadata
  â”‚                     â”‚                     â”‚ for PMID 11111      â”‚
  â”‚                     â”‚                     â”‚ and PMID 22222      â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Find PDF URLs from  â”‚
  â”‚                     â”‚                     â”‚ 11 sources (parallel)
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Download PDFs with  â”‚
  â”‚                     â”‚                     â”‚ retry logic         â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Save PDF            â”‚
  â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                     â”‚                     â”‚                     â”‚ PMID_11111.pdf
  â”‚                     â”‚                     â”‚                     â”‚ PMID_22222.pdf
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Parse PDFs:         â”‚
  â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                     â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                     â”‚                     â”‚ â”‚ abstract: "..." â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚ methods: "..."  â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚ results: "..."  â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚ discussion: "..." â”‚
  â”‚                     â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Attach to dataset:  â”‚
  â”‚                     â”‚                     â”‚ dataset.fulltext = [â”‚
  â”‚                     â”‚                     â”‚   {pmid:"11111",    â”‚
  â”‚                     â”‚                     â”‚    methods:"...",   â”‚
  â”‚                     â”‚                     â”‚    results:"..."},  â”‚
  â”‚                     â”‚                     â”‚   {pmid:"22222",    â”‚
  â”‚                     â”‚                     â”‚    methods:"...",   â”‚
  â”‚                     â”‚                     â”‚    results:"..."}   â”‚
  â”‚                     â”‚                     â”‚ ]                   â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Return enriched dataset                   â”‚
  â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Update currentResults[1]                  â”‚
  â”‚                     â”‚ with enriched data  â”‚                     â”‚
  â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚
  â”‚                     â”‚ â”‚ geo_id: GSE789012â”‚                     â”‚
  â”‚                     â”‚ â”‚ fulltext: [...]  â”‚                     â”‚
  â”‚                     â”‚ â”‚ fulltext_count: 2â”‚                     â”‚
  â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Re-render ALL cards â”‚                     â”‚
  â”‚                     â”‚ displayResults()    â”‚                     â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚ See updated Card 1  â”‚                     â”‚                     â”‚
  â”‚ "2 PDFs available"  â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
```

---

## Detailed Sequence: AI Analysis

### Scenario: User clicks "AI Analysis" on Card 1 (GSE789012) after downloading

```
USER                 FRONTEND              BACKEND               GPT-4
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚ Click AI Analysis   â”‚                     â”‚                     â”‚
  â”‚ on Card 1          â”‚                     â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Get dataset object  â”‚                     â”‚
  â”‚                     â”‚ from currentResults[1]                    â”‚
  â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚
  â”‚                     â”‚ â”‚ geo_id: GSE789012â”‚                     â”‚
  â”‚                     â”‚ â”‚ fulltext: [      â”‚                     â”‚
  â”‚                     â”‚ â”‚   {pmid:"11111", â”‚                     â”‚
  â”‚                     â”‚ â”‚    methods:"..."}, â”‚                   â”‚
  â”‚                     â”‚ â”‚   {pmid:"22222", â”‚                     â”‚
  â”‚                     â”‚ â”‚    methods:"..."}  â”‚                   â”‚
  â”‚                     â”‚ â”‚ ]                â”‚                     â”‚
  â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ POST /analyze       â”‚                     â”‚
  â”‚                     â”‚ Body: {             â”‚                     â”‚
  â”‚                     â”‚   datasets: [dataset],                    â”‚
  â”‚                     â”‚   query: "cancer"   â”‚                     â”‚
  â”‚                     â”‚ }                   â”‚                     â”‚
  â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Check fulltext countâ”‚
  â”‚                     â”‚                     â”‚ total = 2 papers    â”‚
  â”‚                     â”‚                     â”‚ âœ… Has full-text    â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Build prompt:       â”‚
  â”‚                     â”‚                     â”‚ for ds in datasets: â”‚
  â”‚                     â”‚                     â”‚   for ft in ds.fulltext:
  â”‚                     â”‚                     â”‚     prompt += ft.methods
  â”‚                     â”‚                     â”‚     prompt += ft.results
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Prompt text:        â”‚
  â”‚                     â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                     â”‚                     â”‚ â”‚Dataset GSE789012â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚Paper 1 PMID 11111â”‚
  â”‚                     â”‚                     â”‚ â”‚Methods: "Used   â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚RNA-seq on..."   â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚Results: "Found  â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚123 DEGs..."     â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚Paper 2 PMID 22222â”‚
  â”‚                     â”‚                     â”‚ â”‚Methods: "Appliedâ”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚CRISPR..."       â”‚ â”‚
  â”‚                     â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Send to GPT-4       â”‚
  â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚ Analyze Methods
  â”‚                     â”‚                     â”‚                     â”‚ from papers
  â”‚                     â”‚                     â”‚                     â”‚ 11111 & 22222
  â”‚                     â”‚                     â”‚                     â”‚ (NOT 12345/67890!)
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚ Return analysis     â”‚
  â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                     â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                     â”‚                     â”‚ â”‚"This study used â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚RNA-seq and      â”‚ â”‚
  â”‚                     â”‚                     â”‚ â”‚CRISPR methods..." â”‚
  â”‚                     â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Return analysis     â”‚                     â”‚
  â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚                     â”‚ Display inline in   â”‚                     â”‚
  â”‚                     â”‚ Card 1 analysis areaâ”‚                     â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
  â”‚ See AI analysis     â”‚                     â”‚                     â”‚
  â”‚ for GSE789012       â”‚                     â”‚                     â”‚
  â”‚ (correct papers!)   â”‚                     â”‚                     â”‚
  â”‚                     â”‚                     â”‚                     â”‚
```

---

## Object Lifecycle Diagram

### How Dataset Objects Flow Through the System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SEARCH PHASE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ API returns array of datasets
                                â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ currentResults = [                   â”‚
              â”‚   Dataset(geo_id="GSE123456"),       â”‚
              â”‚   Dataset(geo_id="GSE789012"),       â”‚
              â”‚   Dataset(geo_id="GSE555555")        â”‚
              â”‚ ]                                    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ User clicks Download on index 1
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOWNLOAD PHASE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                   â”‚
              â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Send to backend:     â”‚          â”‚ Backend receives:    â”‚
  â”‚ currentResults[1]    â”‚  â”€â”€â”€â”€â”€â”€â–º â”‚ datasets = [         â”‚
  â”‚ {                    â”‚          â”‚   Dataset(           â”‚
  â”‚   geo_id: "GSE789012"â”‚          â”‚     geo_id="GSE789012"â”‚
  â”‚   pubmed_ids: [...]  â”‚          â”‚     pubmed_ids=[...] â”‚
  â”‚   fulltext: []       â”‚          â”‚     fulltext=[]      â”‚
  â”‚ }                    â”‚          â”‚   )                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ ]                    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Process dataset
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Download PDFs for    â”‚
                                    â”‚ THIS dataset's PMIDs â”‚
                                    â”‚                      â”‚
                                    â”‚ Parse PDFs           â”‚
                                    â”‚                      â”‚
                                    â”‚ dataset.fulltext = [ â”‚
                                    â”‚   {...parsed...}     â”‚
                                    â”‚ ]                    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Return enriched
                                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                   â”‚
              â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Frontend receives:   â”‚          â”‚ Update array:        â”‚
  â”‚ enrichedDataset      â”‚  â”€â”€â”€â”€â”€â”€â–º â”‚ currentResults[1] =  â”‚
  â”‚ {                    â”‚          â”‚   enrichedDataset    â”‚
  â”‚   geo_id: "GSE789012"â”‚          â”‚                      â”‚
  â”‚   fulltext: [...]    â”‚          â”‚ âœ… Same index!       â”‚
  â”‚   fulltext_count: 2  â”‚          â”‚ âœ… Same geo_id!      â”‚
  â”‚ }                    â”‚          â”‚                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ User clicks AI Analysis
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI ANALYSIS PHASE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                   â”‚
              â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Send to backend:     â”‚          â”‚ Backend receives:    â”‚
  â”‚ currentResults[1]    â”‚  â”€â”€â”€â”€â”€â”€â–º â”‚ datasets = [         â”‚
  â”‚ {                    â”‚          â”‚   Dataset(           â”‚
  â”‚   geo_id: "GSE789012"â”‚          â”‚     geo_id="GSE789012"â”‚
  â”‚   fulltext: [        â”‚          â”‚     fulltext=[...]   â”‚
  â”‚     {pmid:"11111",   â”‚          â”‚   )                  â”‚
  â”‚      methods:"..."}  â”‚          â”‚ ]                    â”‚
  â”‚   ]                  â”‚          â”‚                      â”‚
  â”‚ }                    â”‚          â”‚ âœ… Includes fulltext!â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Build prompt
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ for ds in datasets:  â”‚
                                    â”‚   âœ… ds.geo_id =     â”‚
                                    â”‚      "GSE789012"     â”‚
                                    â”‚                      â”‚
                                    â”‚   for ft in ds.fulltext:
                                    â”‚     âœ… ft.pmid in    â”‚
                                    â”‚       ["11111",      â”‚
                                    â”‚        "22222"]      â”‚
                                    â”‚                      â”‚
                                    â”‚ Send to GPT-4        â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Return analysis
                                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Frontend displays analysis          â”‚
              â”‚ âœ… Correct dataset analyzed!        â”‚
              â”‚ âœ… Correct papers used!             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Isolation Points

### 1. Frontend Array Isolation
```javascript
// Each index points to a DIFFERENT object
currentResults[0] !== currentResults[1]  // âœ… Different objects

// Each object has its OWN fulltext array
currentResults[0].fulltext !== currentResults[1].fulltext  // âœ… Different arrays
```

### 2. Backend Loop Isolation
```python
for dataset in datasets:  # Process ONE dataset at a time
    dataset.fulltext = []  # âœ… NEW array for THIS dataset

    for pub in publications:  # Publications from THIS dataset's PMIDs
        parsed = parse_pdf(pub.pdf_path)
        dataset.fulltext.append(parsed)  # âœ… Append to THIS dataset only
```

### 3. File System Isolation
```bash
# Each PDF has UNIQUE filename based on PMID
PMID_11111.pdf  # Cannot collide with PMID_12345.pdf
PMID_22222.pdf  # Cannot collide with PMID_67890.pdf

# PMIDs are globally unique in PubMed database (26+ million records)
```

### 4. Object Identity Chain
```
geo_id: "GSE789012"  â† Unique identifier (never changes)
    â”‚
    â”œâ”€ pubmed_ids: ["11111", "22222"]  â† Unique PMIDs
    â”‚       â”‚
    â”‚       â”œâ”€ Download: PMID_11111.pdf, PMID_22222.pdf
    â”‚       â””â”€ Parse: Extract Methods, Results, Discussion
    â”‚
    â””â”€ fulltext: [
           {pmid: "11111", methods: "...", results: "..."},
           {pmid: "22222", methods: "...", results: "..."}
       ]  â† Attached to THIS dataset only

When sent to AI analysis:
    dataset.geo_id = "GSE789012"  â† Still same ID
    dataset.fulltext[0].pmid = "11111"  â† Still same PMIDs

GPT-4 receives Methods/Results from papers 11111 & 22222 ONLY âœ…
```

---

## Why Mixing Cannot Occur

### Scenario: Try to Mix Data (Impossible)

```javascript
// âŒ IMPOSSIBLE: Arrays are not shared
currentResults[0].fulltext.push(...currentResults[1].fulltext);
// â†‘ This would require manual code to explicitly copy
// â†‘ No such code exists in the codebase

// âœ… REALITY: Each download replaces entire object
currentResults[1] = enrichedDataset;  // Atomic replacement
// â†‘ Old object discarded
// â†‘ New object has fresh fulltext array
// â†‘ No way to contaminate other indices
```

### Scenario: Backend Mixes Data (Impossible)

```python
# âŒ IMPOSSIBLE: Loop processes independently
for dataset in datasets:  # ONE dataset per iteration
    dataset.fulltext = []  # â† NEW array each time
    # â†‘ Previous iterations cannot affect this

    for pub in publications:  # â† Publications from THIS dataset's PMIDs
        # â†‘ Cannot accidentally get publications from other datasets
        # â†‘ Because publications list is built from THIS dataset's PMIDs
```

---

## Testing the Mechanism

### Manual Test Steps

1. **Download datasets in order: 1, 0, 2**
   - Card 1 (GSE789012) â†’ Downloads PMIDs 11111, 22222
   - Card 0 (GSE123456) â†’ Downloads PMIDs 12345, 67890
   - Card 2 (GSE555555) â†’ Downloads PMIDs 33333, 44444

2. **Check browser console:**
   ```javascript
   console.log(currentResults[0].geo_id);  // "GSE123456"
   console.log(currentResults[0].fulltext[0].pmid);  // "12345" âœ…

   console.log(currentResults[1].geo_id);  // "GSE789012"
   console.log(currentResults[1].fulltext[0].pmid);  // "11111" âœ… (NOT 12345!)
   ```

3. **Analyze datasets in reverse order: 2, 0, 1**
   - Card 2 â†’ AI uses PMIDs 33333, 44444
   - Card 0 â†’ AI uses PMIDs 12345, 67890
   - Card 1 â†’ AI uses PMIDs 11111, 22222 âœ… (Correct!)

4. **Check backend logs:**
   ```
   [INFO] Analyzing GSE789012...
   [DOC] PMID 11111: methods_len=1234 chars  âœ… Correct PMID
   [DOC] PMID 22222: methods_len=2345 chars  âœ… Correct PMID
   ```

---

## Summary

**Three-Layer Protection Against Mixing:**

1. **Frontend:** Array index stability (`currentResults[index]`)
2. **Backend:** Independent processing (`for dataset in datasets:`)
3. **Database:** Unique filenames (`PMID_12345.pdf`)

**Result:** Perfect dataset isolation at every level! ğŸ¯
